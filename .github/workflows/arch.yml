name: Debug DEB Package
on: [workflow_dispatch]

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install tools
      run: |
        sudo apt-get update
        sudo apt-get install -y file binutils dpkg
        
    - name: Debug package file
      run: |
        echo "=== 详细检查包文件 ==="
        
        # 检查 dist 目录
        echo "dist 目录内容:"
        ls -la dist/ || echo "dist 目录不存在"
        
        # 检查具体文件
        for deb in dist/*.deb; do
          if [ -f "$deb" ]; then
            echo "=== 检查文件: $deb ==="
            echo "文件类型: $(file "$deb")"
            echo "文件大小: $(ls -lh "$deb" | cut -d' ' -f5)"
            echo "MD5: $(md5sum "$deb" | cut -d' ' -f1)"
            
            # 尝试解包
            echo "=== 尝试解包 ==="
            mkdir -p temp_extract
            cd temp_extract
            ar -x "../$deb" 2>&1 || echo "ar 解包失败"
            ls -la
            cd ..
            rm -rf temp_extract
            
            echo "----------------------------------------"
          fi
        done
