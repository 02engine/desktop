name: Download Release Assets
on:
  push:
    branches: [ main, master ]

jobs:
  download-assets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download release assets
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 创建目标目录
          mkdir -p dist

          # 获取最新发布的资源文件
          assets_url=${{ github.event.release.assets_url }}

          # 使用 GitHub API 获取资源列表并下载
          curl -s -H "Authorization: token $GITHUB_TOKEN" \
            $assets_url | jq -r '.[].browser_download_url' | \
            while read url; do
              filename=$(basename "$url")
              echo "Downloading $filename..."
              curl -s -L -H "Authorization: token $GITHUB_TOKEN" \
                "$url" -o "dist/$filename"
            done

      - name: List downloaded files
        run: ls -la dist/
